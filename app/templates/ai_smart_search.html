<!-- app/templates/ai_smart_search.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Smart Search | ChronicleCloud</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      background: #f4f6f8;
      font-family: 'Segoe UI', sans-serif;
    }
    .search-box {
      max-width: 600px;
      margin: 60px auto 20px;
    }
    .result-section {
      margin-top: 30px;
    }
    .card-title {
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="search-box">
    <h2 class="text-center mb-4">üîç AI Smart Search</h2>
    <form id="searchForm">
      <div class="input-group">
        <input type="text" class="form-control" id="queryInput" placeholder="Search notes, blogs, or files..." required />
        <button class="btn btn-primary" type="submit">Search</button>
      </div>
    </form>
    <div id="searchMessage" class="text-center mt-3 text-danger"></div>
  </div>

  <div class="result-section" id="results"></div>
</div>

<script>
document.getElementById('searchForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const query = document.getElementById('queryInput').value.trim();
  const resultsDiv = document.getElementById('results');
  const message = document.getElementById('searchMessage');
  message.textContent = '';
  resultsDiv.innerHTML = '';

  if (!query) {
    message.textContent = 'Please enter a search query.';
    return;
  }

  fetch('/ai/smart_search', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ query })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'success') {
      const { notes, blogs, files } = data.results;

      if (notes.length === 0 && blogs.length === 0 && files.length === 0) {
        resultsDiv.innerHTML = '<p class="text-center text-muted">No results found.</p>';
        return;
      }

      let html = '';

      if (notes.length) {
        html += '<h4>üìù Notes</h4><div class="list-group mb-4">';
        notes.forEach(note => {
          html += `<a href="/notes/view/${note.id}" class="list-group-item list-group-item-action">${note.title}</a>`;
        });
        html += '</div>';
      }

      if (blogs.length) {
        html += '<h4>üì∞ Blogs</h4><div class="list-group mb-4">';
        blogs.forEach(blog => {
          html += `<a href="/blogs/view/${blog.id}" class="list-group-item list-group-item-action">${blog.title}</a>`;
        });
        html += '</div>';
      }

      if (files.length) {
        html += '<h4>üìÅ Files</h4><div class="list-group mb-4">';
        files.forEach(file => {
          html += `<a href="/files/download/${file.id}" class="list-group-item list-group-item-action">${file.filename}</a>`;
        });
        html += '</div>';
      }

      resultsDiv.innerHTML = html;
    } else {
      message.textContent = data.message || 'Something went wrong.';
    }
  });
});
</script>

</body>
</html>
