<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Dashboard</title>
    <script>
        async function loadMessages(groupId) {
            const response = await fetch(`/chat/group/${groupId}/messages`);
            const messages = await response.json();
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            messages.forEach(msg => {
                messagesDiv.innerHTML += `<p><strong>${msg.user}:</strong> ${msg.content} <em>(${msg.timestamp})</em></p>`;
            });
            document.getElementById('sendBtn').onclick = () => sendMessage(groupId);
        }

        async function sendMessage(groupId) {
            const content = document.getElementById('msgInput').value;
            const response = await fetch(`/chat/group/${groupId}/send`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content })
            });
            if (response.ok) {
                document.getElementById('msgInput').value = '';
                loadMessages(groupId);
            }
        }
    </script>
</head>
<body>
    <h1>Welcome to Chat</h1>

    <h2>Your Groups</h2>
    <ul>
        {% for group in groups %}
        <li>
            <button onclick="loadMessages({{ group.id }})">{{ group.name }}</button>
        </li>
        {% endfor %}
    </ul>

    <div id="messages" style="border:1px solid #ccc; padding:10px; margin-top:10px; max-height:300px; overflow-y:auto;"></div>

    <input type="text" id="msgInput" placeholder="Type a message">
    <button id="sendBtn">Send</button>

    <hr>
    <h3>Create Group</h3>
    <form method="post" action="{{ url_for('chat.create_group') }}">
        <input type="text" name="name" placeholder="Group name" required>
        <input type="text" name="description" placeholder="Description">
        <button type="submit">Create</button>
    </form>

    <h3>Join Group</h3>
    <form method="post" action="{{ url_for('chat.join_group') }}">
        <input type="number" name="group_id" placeholder="Group ID" required>
        <button type="submit">Join</button>
    </form>
</body>
</html>
